<!DOCTYPE html>

<html>
    <head>
        <title>Hello Snaps!</title>
    </head>

    <body>
        <h1>Hello Snaps!</h1>
        <details>
            <summary>Instructions</summary>
            <ul>
                <li>First, click "Connect". Then, try out the other buttons!</li>
                <li>Please note that:</li>
                <ul>
                    <li>
                        The Snap <b>package.json</b> must be located in located in the server root
                        directory
                    </li>
                    <li>
                        The Snap bundle must be hosted at the location specified by
                        <b>package.json:web3Wallet.bundle.url</b>
                    </li>
                </ul>
            </ul>
        </details>
        <br />

        <button class="connect">Connect</button>
        <button class="sendHello">Send Hello</button>
        <button class="test">Test</button>
    </body>

    <script>
        // When developing locally, we identify Snaps like this
        const snapId = `local:http://localhost:8081`;

        const connectButton = document.querySelector("button.connect");
        const sendButton = document.querySelector("button.sendHello");
        const testButton = document.querySelector("button.test");

        connectButton.addEventListener("click", connect);
        sendButton.addEventListener("click", send);
        testButton.addEventListener("click", test);

        async function test() {
            console.log(
                await ethereum.request({
                    method: "wallet_getSnaps",
                    params: [],
                }),
            );

            console.log(
                await ethereum.request({
                    method: "wallet_getPermissions",
                    params: [snapId],
                }),
            );
        }

        // here we get permissions to interact with and install the snap
        async function connect() {
            console.log(
                await ethereum.request({
                    method: "wallet_enable",
                    params: [
                        {
                            wallet_snap: { [snapId]: {} },
                        },
                    ],
                }),
            );
        }

        // here we call the snap's "hello" method
        async function send() {
            try {
                const response = await ethereum.request({
                    method: "wallet_invokeSnap",
                    params: [
                        snapId,
                        {
                            method: "hello",
                        },
                    ],
                });
            } catch (err) {
                console.error(err);
                alert("Problem happened: " + err.message || err);
            }
        }
    </script>

    <!-- <script> -->
    <!--     // we identify the Snap by the location of its package.json file -->
    <!--     // const snapId = new URL('package.json', window.location.href).toString() -->
    <!--     const snapId = "wallet_snap_http://localhost:8081"; -->
    <!---->
    <!--     async function sendSnapMethod(request) { -->
    <!--         return await window.ethereum.request({ -->
    <!--             method: snapId, -->
    <!--             params: [request], -->
    <!--         }); -->
    <!--     } -->
    <!---->
    <!--     const connectButton = document.querySelector("button.connect"); -->
    <!--     const sendButton = document.querySelector("button.sendHello"); -->
    <!---->
    <!--     connectButton.addEventListener("click", connect); -->
    <!--     sendButton.addEventListener("click", send); -->
    <!---->
    <!--     // here we get permissions to interact with and install the plugin -->
    <!--     async function connect() { -->
    <!--         console.log("permissions", await ethereum.request({ method: "wallet_getPermissions" })); -->
    <!---->
    <!--         console.log( -->
    <!--             "trying something", -->
    <!--             await window.ethereum.request({ -->
    <!--                 method: "wallet_getSnaps", -->
    <!--             }), -->
    <!--         ); -->
    <!---->
    <!--         // await ethereum.request({ -->
    <!--         //   method: 'wallet_enable', -->
    <!--         //   params: [{ -->
    <!--         //     [snapId]: {}, -->
    <!--         //   }] -->
    <!--         // }) -->
    <!---->
    <!--         // enable snap -->
    <!--         await window.ethereum.request({ -->
    <!--             method: "wallet_enable", -->
    <!--             params: [ -->
    <!--                 { -->
    <!--                     [snapId]: {}, -->
    <!--                 }, -->
    <!--                 // { allet_invokeSnap: [] }, -->
    <!--             ], -->
    <!--         }); -->
    <!---->
    <!--         await sendSnapMethod({ method: "ar_hello" }); -->
    <!---->
    <!--         // console.log( -->
    <!--         //     "trying something", -->
    <!--         //     await window.ethereum.request({ -->
    <!--         //         method: "wallet_getSnaps", -->
    <!--         //     }), -->
    <!--         // ); -->
    <!---->
    <!--         // await window.ethereum.request({ -->
    <!--         //     method: "wallet_enable", -->
    <!--         //     params: [{ -->
    <!--         //         [snapId]: {} -->
    <!--         //     }] -->
    <!--         // }); -->
    <!--     } -->
    <!---->
    <!--     // here we call the plugin's "hello" method -->
    <!--     async function send() { -->
    <!--         // console.log("requesting permission"); -->
    <!--         // -->
    <!--         // console.log( -->
    <!--         //     await ethereum.request({ -->
    <!--         //         method: "wallet_requestPermissions", -->
    <!--         //         params: [{ eth_accounts: {} }], -->
    <!--         //     }), -->
    <!--         // ); -->
    <!--         // -->
    <!--         // console.log( -->
    <!--         //     await ethereum.request({ -->
    <!--         //         method: "wallet_requestPermissions", -->
    <!--         //         params: [{ wallet_invokeSnap: {} }], -->
    <!--         //     }), -->
    <!--         // ); -->
    <!---->
    <!--         try { -->
    <!--             const response = await ethereum.request({ -->
    <!--                 method: "wallet_invokeSnap", -->
    <!--                 params: [ -->
    <!--                     snapId, -->
    <!--                     { -->
    <!--                         method: "hello", -->
    <!--                     }, -->
    <!--                 ], -->
    <!--             }); -->
    <!--             console.log("INVOKE", response); -->
    <!--         } catch (err) { -->
    <!--             console.error(err); -->
    <!--             alert("Problem happened: " + err.message || err); -->
    <!--         } -->
    <!--     } -->
    <!-- </script> -->
</html>
